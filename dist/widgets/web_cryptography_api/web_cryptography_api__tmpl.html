<html>
    <head>
        <link rel="stylesheet" href="https://arcanus55.github.io/neodigm55/dist/neodigm55__v3_1.css"></link>
        <script src="https://arcanus55.github.io/neodigm55/dist/neodigm55__v3_1.js"></script>
        <link rel="stylesheet" href="https://arcanus55.github.io/neodigm55/dist/neodigm55_v1_0_launchComplete.css"></link>
    </head>
    <body  data-n55-ampm-theme="light">


<!--  ||  TEMPLATE MU & CSS WDG BEGIN -->
<wtt-widget data-n55-token="web_cryptography_api">
    <section class="pfmf-grid pfmf-grid__100 readable__doc" style="padding: 1px;">
        <div>
            <article class="pfmf-crd--black h-center"><p id="js-fb__top" class="hd5 readampm__white">Type or Paste Your Key Below</p></article>
            <article style="padding: 1px 1px; margin: 0;">
                <input id="l-term-key" class="l-term" type="password"></input>
            </article>
        </div>
    </section>
    <br>
    
    <section class="pfmf-grid pfmf-grid__100 readable__doc" style="padding: 1px;">
        <div>
            <article class="pfmf-crd--black h-center"><p class="hd5 readampm__white">Type or Paste Your Source Text Below</p></article>
            <div id="l-cntr-term-from">
                <article style="padding: 1px 1px; margin: 0;">
                    <textarea id="l-term-from" class="l-term" rows="6"></textarea>
                </article>
            </div>
        </div>
    </section>
    
    <section class="Qpfmf-grid pfmf-grid__100 readable__doc" style="padding: 1px;">
        <div>
            <article style="padding: 1px 1px; margin: 0;">
                <nav class="h-center" style="margin-top: -8px;">

                    <neodigm-acticon id="js-term-to-copy" data-n55-theme="ghost" data-n55-size="small"
                    data-n55-wired4sound-click="16"
                    data-n55-tulip='{"msg":" Copy the Above Text","mrq":false,"tmpt":"","theme":"ghost","size":"xsmall","position":"bottom","icon":""}'
                    onclick="doAction('fromCopy')"
                    ><neodigm-icon data-n55-wired4sound-hover="3" class="material-symbols-outlined">content_copy</neodigm-icon></neodigm-acticon>

                    <neodigm-acticon id="js-term-to-paste" data-n55-theme="ghost" data-n55-size="small"
                    data-n55-wired4sound-click="16"
                    data-n55-tulip='{"msg":" Paste Clipboard Above","mrq":false,"tmpt":"","theme":"ghost","size":"xsmall","position":"bottom","icon":""}'
                    onclick="doAction('fromPaste')"
                    ><neodigm-icon data-n55-wired4sound-hover="3" class="material-symbols-outlined">content_paste</neodigm-icon></neodigm-acticon>

                    <neodigm-acticon id="js-term-to-clear" data-n55-theme="ghost" data-n55-size="small" 
                    data-n55-wired4sound-click="11"
                    data-n55-tulip='{"msg":" Clear Text Above","mrq":false,"tmpt":"","theme":"danger","size":"xsmall","position":"bottom","icon":""}'
                    onclick="doAction('fromClear')"
                    ><neodigm-icon data-n55-wired4sound-hover="3" class="material-symbols-outlined">delete</neodigm-icon></neodigm-acticon>

                </nav>
            </article>
        </div>
    </section>
    
    <section class="pfmf-grid pfmf-grid__100 readable__doc" style="padding: 1px;">
        <div>
            <article class="h-center">
                <a id="js-crypt-encrypt"
                onclick="doAction('crypt-encrypt')"
                data-n55-enchanted-cta data-n55-enchanted-cta-dont-touch="true" data-n55-enchanted-cta-shape-off="true" data-n55-enchanted-cta-hover-an="true"
                data-n55-enchanted-cta-size="xsmall"
                data-n55-flash-theme="marcom"
                data-n55-theme="ghost"
                data-n55-wired4sound-hover="3"
                data-n55-wired4sound-click="7"
                ><span data-n55-wired4sound-mouseover="3">Encrypt</span><span>Make Hidden</span>
                </a>
                <a id="js-crypt-decrypt"
                onclick="doAction('crypt-decrypt')"
                data-n55-enchanted-cta data-n55-enchanted-cta-dont-touch="true" data-n55-enchanted-cta-shape-off="true" data-n55-enchanted-cta-hover-an="true"
                data-n55-enchanted-cta-size="xsmall"
                data-n55-flash-theme="marcom"
                data-n55-theme="ghost"
                data-n55-wired4sound-hover="3"
                data-n55-wired4sound-click="5"
                ><span data-n55-wired4sound-mouseover="3">Decrypt</span><span>Make Readable</span>
                </a>
                <a id="js-touch-point__share" data-n55-enchanted-cta data-n55-enchanted-cta-dont-touch="false" data-n55-enchanted-cta-shape-off="true" data-n55-enchanted-cta-hover-an="true"
                data-wtt-share-uri="https://www.WebToolToys.com/"
                data-n55-sodapop-id="js-wtt-sndbxshare-pup"
                data-n55-enchanted-cta-size="xsmall"
                data-n55-theme="brand"
                data-n55-flash-theme="warning"
                data-n55-wired4sound-click="16"
                data-n55-tulip= '{"msg":" Copy this Web Address and send to a friend. ","mrq":true,"tmpt":"","theme":"brand","size":"small","position":"bottom","icn":""}'
                ><span data-n55-wired4sound-hover="3"><neodigm-icon class="material-symbols-outlined">share</neodigm-icon> Share</span><span><neodigm-icon class="material-symbols-outlined">share</neodigm-icon>  Copy URL</span>
                </a>              
            </article>
        </div>
    </section>
    
    <section class="pfmf-grid pfmf-grid__100 readable__doc" style="padding: 1px;">
        <div>
            <div id="l-cntr-term-to">
                <article style="padding: 1px 1px; margin: 0;">
                    <textarea id="l-term-to" class="l-term" rows="6"></textarea>
                </article>
            </div>
        </div>
    </section>
    
    <section class="Qpfmf-grid pfmf-grid__100 readable__doc" style="padding: 1px;">
        <div>
            <article style="padding: 1px 1px; margin: 0;">

                <nav class="h-center" style="margin-top: -8px;">

                    <neodigm-acticon id="js-term-to-save" data-n55-theme="ghost" data-n55-size="small"
                    data-n55-wired4sound-click="16"
                    data-n55-tulip='{"msg":" Download and save the Above content as a TXT file. ","mrq":true,"tmpt":"","theme":"ghost","size":"xsmall","position":"bottom","icon":""}'
                    onclick="doAction('toSave')"
                    ><neodigm-icon data-n55-wired4sound-hover="3" class="material-symbols-outlined">download</neodigm-icon></neodigm-acticon>

                    <neodigm-acticon id="js-term-to-copy" data-n55-theme="ghost" data-n55-size="small"
                    data-n55-wired4sound-click="16"
                    data-n55-tulip='{"msg":" Copy the Above Text","mrq":false,"tmpt":"","theme":"ghost","size":"xsmall","position":"bottom","icon":""}'
                    onclick="doAction('toCopy')"
                    ><neodigm-icon data-n55-wired4sound-hover="3" class="material-symbols-outlined">content_copy</neodigm-icon></neodigm-acticon>

                    <neodigm-acticon id="js-term-to-paste" data-n55-theme="ghost" data-n55-size="small"
                    data-n55-wired4sound-click="16"
                    data-n55-tulip='{"msg":" Paste Clipboard Above","mrq":false,"tmpt":"","theme":"ghost","size":"xsmall","position":"bottom","icon":""}'
                    onclick="doAction('toPaste')"
                    ><neodigm-icon data-n55-wired4sound-hover="3" class="material-symbols-outlined">content_paste</neodigm-icon></neodigm-acticon>

                    <neodigm-acticon id="js-term-to-clear" data-n55-theme="ghost" data-n55-size="small" 
                    data-n55-wired4sound-click="11"
                    data-n55-tulip='{"msg":" Clear Text Above","mrq":false,"tmpt":"","theme":"danger","size":"xsmall","position":"bottom","icon":""}'
                    onclick="doAction('toClear')"
                    ><neodigm-icon data-n55-wired4sound-hover="3" class="material-symbols-outlined">delete</neodigm-icon></neodigm-acticon>

                </nav>
            </article>
        </div>
    </section>
</wtt-widget>

<style>
.l-term {
    background-color: #5A5852;
    border-radius: 8px;
    color: #fff;
    display: block;    
    font-size: 14px;
    padding: 4px; margin: 2px auto;
    width: 99%;
}
</style>
<!--  ||  TEMPLATE MU & CSS WDG END -->














<!--  ||  JAVASCRIPT WDG BEGIN -->

<!--  ||  Dont copy script tags -->
<script> 
//  Soda Pop Tmpl logic
/*
setTimeout(function(){
    if( neodigmSodaPop && neodigmMarquee && neodigmEnchantedCTA ){
        neodigmSodaPop.setOnAfterOpen( function(){
NeodigmClaire.showCanv('neodigm-sodapop', .6).setTheme( ['brand','warning'] ).initCanvOn('neodigm-sodapop').waxOn('neodigm-sodapop')
            neodigmMetronome.init().pause( 800 )
                neodigmMarquee.init().pause( 1200 )
                    neodigmEnchantedCTA.init()
                    neodigmCarousel.init()
        });
        neodigmSodaPop.setOnBeforeUserExit( function(){
            neodigmToast.q("Got Questions?|Start a Conversation!", "brand")
            if( neodigmSodaPop && (  neodigmSodaPop.isOpen() )) olark('api.box.expand')
            if( neodigmSodaPop && ( !neodigmSodaPop.isOpen() )) neodigmSodaPop.autoOpen('js-contactPop__id')
        } )
    }
}, 3e3)
setTimeout(function(){
    if( neodigmSodaPop && NeodigmClaire ){
        neodigmSodaPop.setOnClose( function(){
NeodigmClaire.showCanv('neodigm-sodapop').initCanvOff('neodigm-sodapop').waxOff('neodigm-sodapop');
            return true;
        });
    }
}, 4e3)
*/
    const buff_to_base64 = (buff) => btoa(
        new Uint8Array(buff).reduce(
            (data, byte) => data + String.fromCharCode(byte), ''
        )
    );
  
  const base64_to_buf = (b64) =>
    Uint8Array.from(atob(b64), (c) => c.charCodeAt(null));
  
  const enc = new TextEncoder();
  const dec = new TextDecoder();
  
  const getPasswordKey = (password) =>
    window.crypto.subtle.importKey("raw", enc.encode(password), "PBKDF2", false, [
      "deriveKey",
    ]);
  
  const deriveKey = (passwordKey, salt, keyUsage) =>
    window.crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: salt,
        iterations: 250000,
        hash: "SHA-256",
      },
      passwordKey,
      { name: "AES-GCM", length: 256 },
      false,
      keyUsage
    );
  
  async function encryptData(secretData, password) {
    try {
      const salt = window.crypto.getRandomValues(new Uint8Array(16));
      const iv = window.crypto.getRandomValues(new Uint8Array(12));
      const passwordKey = await getPasswordKey(password);
      const aesKey = await deriveKey(passwordKey, salt, ["encrypt"]);
      const encryptedContent = await window.crypto.subtle.encrypt(
        {
          name: "AES-GCM",
          iv: iv,
        },
        aesKey,
        enc.encode(secretData)
      );
  
      const encryptedContentArr = new Uint8Array(encryptedContent);
      let buff = new Uint8Array(
        salt.byteLength + iv.byteLength + encryptedContentArr.byteLength
      );
      buff.set(salt, 0);
      buff.set(iv, salt.byteLength);
      buff.set(encryptedContentArr, salt.byteLength + iv.byteLength);
      const base64Buff = buff_to_base64(buff);
      return base64Buff;
    } catch (e) {
      console.log(`Error - ${e}`);
      return "";
    }
  }
  
  async function decryptData(encryptedData, password) {
    try {
      const encryptedDataBuff = base64_to_buf(encryptedData);
      const salt = encryptedDataBuff.slice(0, 16);
      const iv = encryptedDataBuff.slice(16, 16 + 12);
      const data = encryptedDataBuff.slice(16 + 12);
      const passwordKey = await getPasswordKey(password);
      const aesKey = await deriveKey(passwordKey, salt, ["decrypt"]);
      const decryptedContent = await window.crypto.subtle.decrypt(
        {
          name: "AES-GCM",
          iv: iv,
        },
        aesKey,
        data
      );
      return dec.decode(decryptedContent);
    } catch (e) {
      console.log(`Error - ${e}`);
      return "";
    }
  }
  
  let doAction = async function( sAct ){
      let eTermKey = document.querySelector( "#l-term-key" )
      let eTermFrom = document.querySelector( "#l-term-from" )
      let eTermTo = document.querySelector( "#l-term-to" )
      let capFirst = (s) => (s && s[0].toUpperCase() + s.slice(1))
      if( eTermKey && eTermFrom && eTermTo ){
          if( sAct == "crypt-encrypt" ){
              if( eTermKey.value && eTermFrom.value ){
                  eTermTo.value = await encryptData( eTermFrom.value, eTermKey.value );
                  neodigmUtils.typeOn({"q1st": "#js-fb__top", "msg": "Encrypted " + eTermFrom.value.length + " to " + eTermTo.value.length + " characters|Type or Paste Your Key Below","mode":"NONE","uniqueDelay": 117})
              }else{
                  neodigmToast.q("There is no key / text|to encrypt.", "danger")
              }
          }
  
          if( sAct == "crypt-decrypt" ){
              if( eTermKey.value && eTermFrom.value ){
                  const decryptedData = await decryptData( eTermFrom.value, eTermKey.value );
                  if( eTermTo.value = decryptedData ){
                    neodigmUtils.typeOn({"q1st": "#js-fb__top", "msg": "Decrypted " + eTermFrom.value.length + " to " + eTermTo.value.length + " characters|Type or Paste Your Key Below","mode":"NONE","uniqueDelay": 117})
                  }else{ neodigmUtils.typeOn({"q1st": "#js-fb__top", "msg": "Decryption Failed|Type or Paste Your Key Below","mode":"NONE","uniqueDelay": 119}) }
              }else{
                  neodigmToast.q("There is no key / text|to encrypt.", "danger")
              }
          }
        /*if( sAct == "share" ){
              try {
                  navigator.clipboard.writeText( document.location.href );
                  neodigmToast.q("Page Address (URL)|Copied to Clipboard", "brand" )
              } catch (err) {
                  console.warn('Failed to copy', err)
              }
          } */
          if( sAct == "fromCopy" ){
              if( eTermFrom.value ){
                  try{
                        navigator.clipboard.writeText( eTermFrom.value )
                        neodigmToast.q("Copied to|Clipboard", "primary")
                        neodigmUtils.typeOn({"q1st": "#js-fb__top", "msg": "Copied to Clipboard|Type or Paste Your Key Below","mode":"NONE","uniqueDelay": 117})
                  }catch( er ){
                      neodigmToast.q("Unexpected Error| " + er , "danger")
                  }
              }else{
                  neodigmToast.q("There is no text to copy.", "danger")
                  neodigmUtils.robinTheme("danger");
              }
          }
          if( sAct == "fromPaste" ){
              try{
                  navigator.clipboard
                  .readText()
                  .then((clipText) => ( eTermFrom.value = clipText ));
                  neodigmUtils.typeOn({"q1st": "#js-fb__top", "msg": "Pasted from Clipboard|Type or Paste Your Key Below","mode":"NONE","uniqueDelay": 117})
              }catch( er ){
                  neodigmToast.q("Unexpected Error|" + er , "danger")
              }
          }
          if( sAct == "fromClear" ){ eTermFrom.value = ""; neodigmUtils.robinTheme("danger");
          NeodigmClaire.showCanv('#l-cntr-term-from', .6).setTheme( ['danger'] ).initCanvOn('#l-cntr-term-from').waxOn('#l-cntr-term-from')

         }
  
          if( sAct == "toCopy" ){
              if( eTermTo.value ){
                  try{
                        navigator.clipboard.writeText( eTermTo.value )
                        neodigmUtils.typeOn({"q1st": "#js-fb__top", "msg": "Copied to Clipboard|Type or Paste Your Key Below","mode":"NONE","uniqueDelay": 117})
                  }catch( er ){
                      neodigmToast.q("Unexpected Error| " + er , "danger")
                  }
              }else{
                  neodigmToast.q("There is no text to copy.", "danger")
                  neodigmUtils.robinTheme("danger");
              }
          }
          if( sAct == "toPaste" ){
              try{
                  navigator.clipboard
                  .readText()
                  .then((clipText) => ( eTermTo.value = clipText ));
                    neodigmUtils.typeOn({"q1st": "#js-fb__top", "msg": "Pasted from Clipboard|Type or Paste Your Key Below","mode":"NONE","uniqueDelay": 117})
              }catch( er ){
                  neodigmToast.q("Unexpected Error|" + er , "danger")
              }
          }
        if( sAct == "toClear" ){ eTermTo.value = ""; neodigmUtils.robinTheme("danger");
            NeodigmClaire.showCanv('#l-cntr-term-to', .6).setTheme( ['danger'] ).initCanvOn('#l-cntr-term-to').waxOn('#l-cntr-term-to')
        }
          if( sAct == "toSave" ){  //  Gen and download as Blob
            if( neodigmWired4Sound ) neodigmWired4Sound.vibrate()
            if( eTermTo.value ){
                let sFile = "web_cryptography_api_" + new Date().getTime() + ".txt"
                let sOut = eTermTo.value + "\n\nDownloaded from WebToolToys.com."
                let blOut = new Blob([ sOut ], { type: "text/csv;charset=utf-8;" });
                let elDLoad = document.createElement( "a" );
                elDLoad.setAttribute("href", URL.createObjectURL( blOut ));
                elDLoad.setAttribute("download", sFile );
                elDLoad.style.visibility = 'hidden';
                document.body.appendChild( elDLoad );
                elDLoad.click();
                document.body.removeChild( elDLoad );
                neodigmToast.q("File Downloaded:|" + sFile, "brand")
            }else{
                neodigmToast.q("There is no text to| Download.", "danger")
                neodigmUtils.robinTheme("danger"); neodigmUtils.shake( "#l-term-to" )
                NeodigmClaire.showCanv('#l-cntr-term-to', .6).setTheme( ['danger'] ).initCanvOn('#l-cntr-term-to').waxOn('#l-cntr-term-to')
            }
        }
      }
      return false;
  }
  neodigmMarquee.init();
  neodigmEnchantedCTA.init();

</script><!--  ||  Dont copy script tags -->
<!--  ||  JAVASCRIPT WDG BEGIN -->

    </body>
</html>